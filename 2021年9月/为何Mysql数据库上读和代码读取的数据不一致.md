> 上周，做了一个同步删除的功能，具体流程是，数据库删除-->调用第三方运行删除接口，同步删除。

## 具体流程

* 数据库删除数据后，这里使用标志删除，再调用第三方数据。
* 在调用第三方数据之前需要通过id查询数据，但是数据库查不到数据，把控制台答应的sql语句放在mysql执行，能查到数据。
* 在mysql上查的数据和代码上查的数据不一致。

## 分析原因

细心的读者应该知道了，明明前面数据已经被删了，后面就查不到了。但是当时业务逻辑比较多，本地删除封装了一个方法。第三方删除又是在另外一个类里面。所以后面就没考虑到数据其实已经删除了，所以后面是查不到的。

## 事务隔离级别

但是为什么数据删除了，在mysql中还能查的到呢，这就涉及到事务的隔离级别了。spring 事务默认的隔离级别是根据使用的数据库来的，这里使用的mysql，默认隔离级别是**可重复读（REPEATABLE_READ）**。

由于事务还没执行完，别的sql是读取不到改事务的数据改变。所以在用sql 执行 sql 是可以找到的数据的。

## 总结
数据库上读和代码上读取数据不一致，本质上是由于两个读取不是在同一个事务下，而不在一个事务下，使用不同的事务隔离级别，导致读取的数据也就不一致了。
